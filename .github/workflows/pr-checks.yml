name: PR Checks

on:
  push:
    branches:
      - "main"
  pull_request:
    branches: [ main, develop ]  # main과 develop 브랜치로의 PR에 적용

jobs:
  code-quality:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.9'
        cache: 'pip'
    
    - name: Install Poetry
      uses: snok/install-poetry@v1
      with:
        version: 1.7.1
        virtualenvs-create: true
    
    - name: Install dependencies
      run: |
        poetry install --with dev
    
    - name: Run Black
      run: poetry run black . --check
    
    - name: Run isort
      run: poetry run isort --check --profile black .
    
    - name: Run Pylint
      run: poetry run pylint $(git ls-files '*.py')
    
    - name: Run Mypy
      run: poetry run mypy .
  
  tests:
    runs-on: ubuntu-latest
    needs: code-quality  # 코드 품질 검사가 통과한 후에만 테스트 실행
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.9'
        cache: 'pip'
    
    - name: Install Poetry
      uses: snok/install-poetry@v1
      with:
        version: 1.7.1
        virtualenvs-create: true
    
    - name: Install dependencies
      run: |
        poetry install --with dev
    
    - name: Run tests
      run: poetry run pytest